let sample1 = """[
  {
    "_id": "5bc3b1b7c0d3a4de884f6a68",
    "index": 0,
    "guid": "63179163-ab86-40d5-9c27-553b5122110b",
    "isActive": true,
    "balance": "$3,149.02",
    "picture": "http://placehold.it/32x32",
    "age": 34,
    "eyeColor": "brown",
    "name": {
      "first": "Sophia",
      "last": "Mercer"
    },
    "company": "CANOPOLY",
    "email": "sophia.mercer@canopoly.tv",
    "phone": "+1 (862) 471-2312",
    "address": "472 Navy Street, Driftwood, Tennessee, 6872",
    "about": "Elit fugiat aliquip mollit eu velit nulla sint voluptate irure mollit. Eiusmod sunt eu ut eu Lorem in nostrud. Occaecat non nisi ea aliqua aute exercitation commodo amet voluptate cupidatat ad ad duis. Culpa consequat quis duis duis mollit officia ex nulla anim aliqua mollit do. Ea est Lorem irure amet non ex tempor elit nulla anim. Ullamco ad et eiusmod eiusmod cillum quis.",
    "registered": "Saturday, August 2, 2014 9:15 AM",
    "latitude": "-49.82641",
    "longitude": "-74.264347",
    "tags": [
      "reprehenderit",
      "nulla",
      "ut",
      "ullamco",
      "culpa"
    ],
    "range": [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9
    ],
    "friends": [
      {
        "id": 0,
        "name": "Fox Sheppard"
      },
      {
        "id": 1,
        "name": "Katy Olsen"
      },
      {
        "id": 2,
        "name": "Mavis Burton"
      }
    ],
    "greeting": "Hello, Sophia! You have 6 unread messages.",
    "favoriteFruit": "strawberry"
  },
  {
    "_id": "5bc3b1b7f0ca0fc3b215bc6c",
    "index": 1,
    "guid": "e1942211-c45c-4994-ba9b-db7173d4be91",
    "isActive": true,
    "balance": "$3,734.54",
    "picture": "http://placehold.it/32x32",
    "age": 21,
    "eyeColor": "green",
    "name": {
      "first": "Craft",
      "last": "Ball"
    },
    "company": "ONTALITY",
    "email": "craft.ball@ontality.io",
    "phone": "+1 (860) 486-2447",
    "address": "697 Crawford Avenue, Bellamy, Virgin Islands, 5664",
    "about": "Ut elit eu veniam laboris. Aliquip ut sint nisi nisi fugiat elit eiusmod fugiat amet sunt adipisicing aute proident. Culpa magna nisi eu anim aute proident magna veniam deserunt exercitation dolor cupidatat. In enim anim enim cupidatat anim non. Sunt incididunt aute enim consequat non quis labore laboris adipisicing dolore in adipisicing laborum exercitation. Laborum consectetur do reprehenderit elit. Eiusmod officia dolor quis in excepteur.",
    "registered": "Saturday, July 29, 2017 2:34 PM",
    "latitude": "31.791473",
    "longitude": "169.688391",
    "tags": [
      "laborum",
      "ut",
      "sit",
      "commodo",
      "cupidatat"
    ],
    "range": [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9
    ],
    "friends": [
      {
        "id": 0,
        "name": "Skinner Boyle"
      },
      {
        "id": 1,
        "name": "Consuelo Lyons"
      },
      {
        "id": 2,
        "name": "Walton Gordon"
      }
    ],
    "greeting": "Hello, Craft! You have 7 unread messages.",
    "favoriteFruit": "apple"
  },
  {
    "_id": "5bc3b1b7d4424675d618dcf1",
    "index": 2,
    "guid": "e26c1a19-811f-4d94-9ea8-b7717a4cc341",
    "isActive": true,
    "balance": "$2,624.05",
    "picture": "http://placehold.it/32x32",
    "age": 26,
    "eyeColor": "brown",
    "name": {
      "first": "John",
      "last": "Walker"
    },
    "company": "SEALOUD",
    "email": "john.walker@sealoud.net",
    "phone": "+1 (946) 532-2687",
    "address": "768 Rock Street, Echo, Ohio, 270",
    "about": "Labore culpa aliquip duis duis anim ipsum quis ullamco dolor voluptate eu. Aliquip eu minim eu Lorem commodo officia sit. Do culpa pariatur sunt fugiat.",
    "registered": "Thursday, May 31, 2018 11:37 PM",
    "latitude": "-12.67582",
    "longitude": "-86.885237",
    "tags": [
      "ut",
      "sit",
      "culpa",
      "consequat",
      "magna"
    ],
    "range": [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9
    ],
    "friends": [
      {
        "id": 0,
        "name": "Ashlee Hull"
      },
      {
        "id": 1,
        "name": "Boone Trujillo"
      },
      {
        "id": 2,
        "name": "Velma Whitaker"
      }
    ],
    "greeting": "Hello, John! You have 9 unread messages.",
    "favoriteFruit": "apple"
  },
  {
    "_id": "5bc3b1b7d5ab5c7396404b05",
    "index": 3,
    "guid": "7ce0822e-8d04-472c-b324-908d03023bad",
    "isActive": false,
    "balance": "$1,897.01",
    "picture": "http://placehold.it/32x32",
    "age": 33,
    "eyeColor": "green",
    "name": {
      "first": "Amalia",
      "last": "Mccarthy"
    },
    "company": "ENTROPIX",
    "email": "amalia.mccarthy@entropix.info",
    "phone": "+1 (956) 595-2821",
    "address": "677 Kent Street, Gratton, New York, 9099",
    "about": "Dolor sunt deserunt laborum deserunt occaecat reprehenderit non ea nostrud. Adipisicing eu aliqua fugiat tempor Lorem. Eu veniam anim cillum incididunt id velit esse culpa consectetur cupidatat pariatur laboris exercitation ex.",
    "registered": "Wednesday, July 30, 2014 8:49 AM",
    "latitude": "-61.064105",
    "longitude": "133.466627",
    "tags": [
      "officia",
      "magna",
      "laboris",
      "fugiat",
      "eiusmod"
    ],
    "range": [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9
    ],
    "friends": [
      {
        "id": 0,
        "name": "Pearson Yang"
      },
      {
        "id": 1,
        "name": "Charity Elliott"
      },
      {
        "id": 2,
        "name": "Jensen Santana"
      }
    ],
    "greeting": "Hello, Amalia! You have 5 unread messages.",
    "favoriteFruit": "apple"
  },
  {
    "_id": "5bc3b1b79a3ba4433782a281",
    "index": 4,
    "guid": "0403e585-f7f1-41c0-8f08-ffcec726592e",
    "isActive": false,
    "balance": "$2,130.99",
    "picture": "http://placehold.it/32x32",
    "age": 28,
    "eyeColor": "green",
    "name": {
      "first": "Cindy",
      "last": "Fuller"
    },
    "company": "SOPRANO",
    "email": "cindy.fuller@soprano.org",
    "phone": "+1 (842) 536-2916",
    "address": "874 Saratoga Avenue, Grapeview, Connecticut, 4937",
    "about": "Irure ad sit aliquip Lorem ullamco irure labore. Veniam in est nisi ea nisi et nostrud aute reprehenderit ipsum pariatur proident est. Id qui amet adipisicing laboris est consequat voluptate occaecat eiusmod. Voluptate sit eu nulla mollit quis enim sint minim irure fugiat nulla sit. Minim in esse excepteur quis exercitation consequat cillum tempor id velit laboris adipisicing. Exercitation exercitation sint non enim.",
    "registered": "Saturday, June 30, 2018 9:54 AM",
    "latitude": "-44.916346",
    "longitude": "154.939474",
    "tags": [
      "aliquip",
      "culpa",
      "occaecat",
      "id",
      "culpa"
    ],
    "range": [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9
    ],
    "friends": [
      {
        "id": 0,
        "name": "Jordan King"
      },
      {
        "id": 1,
        "name": "Earnestine Pittman"
      },
      {
        "id": 2,
        "name": "Concepcion Kennedy"
      }
    ],
    "greeting": "Hello, Cindy! You have 9 unread messages.",
    "favoriteFruit": "strawberry"
  },
  {
    "_id": "5bc3b1b7058dc5a97367ed23",
    "index": 5,
    "guid": "bd5572e2-3eb4-4b30-a045-3d45567911b4",
    "isActive": true,
    "balance": "$3,691.58",
    "picture": "http://placehold.it/32x32",
    "age": 23,
    "eyeColor": "brown",
    "name": {
      "first": "Mallory",
      "last": "Deleon"
    },
    "company": "CINESANCT",
    "email": "mallory.deleon@cinesanct.me",
    "phone": "+1 (962) 574-2169",
    "address": "460 Rapelye Street, Yukon, Puerto Rico, 1304",
    "about": "Deserunt in aute adipisicing nostrud in nostrud mollit incididunt ullamco magna cupidatat. Laborum cupidatat voluptate aliquip veniam quis adipisicing mollit excepteur deserunt non. Eu fugiat ullamco culpa id laborum nostrud quis aliqua anim et occaecat consectetur proident consequat. Dolor excepteur consectetur adipisicing id sit cillum veniam eiusmod do incididunt. Magna adipisicing tempor velit incididunt ex enim aliqua.",
    "registered": "Sunday, June 8, 2014 7:14 PM",
    "latitude": "9.375812",
    "longitude": "126.426476",
    "tags": [
      "ad",
      "nulla",
      "dolore",
      "adipisicing",
      "consectetur"
    ],
    "range": [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9
    ],
    "friends": [
      {
        "id": 0,
        "name": "Summers Avila"
      },
      {
        "id": 1,
        "name": "Frederick Browning"
      },
      {
        "id": 2,
        "name": "Queen Vasquez"
      }
    ],
    "greeting": "Hello, Mallory! You have 9 unread messages.",
    "favoriteFruit": "apple"
  },
  {
    "_id": "5bc3b1b7fa67930e48c06326",
    "index": 6,
    "guid": "d8b1870e-3521-43d3-a0eb-795f35c606ac",
    "isActive": true,
    "balance": "$2,531.17",
    "picture": "http://placehold.it/32x32",
    "age": 32,
    "eyeColor": "brown",
    "name": {
      "first": "Watkins",
      "last": "Bolton"
    },
    "company": "BLURRYBUS",
    "email": "watkins.bolton@blurrybus.biz",
    "phone": "+1 (949) 573-2118",
    "address": "392 Seba Avenue, Gilgo, Illinois, 6068",
    "about": "Amet ad tempor enim dolor officia sint nostrud. Sunt sit ea id sint commodo non laborum velit eiusmod ea. Non magna tempor do anim nostrud ipsum Lorem laborum sunt ex aliqua duis culpa. Quis amet do non voluptate mollit tempor velit. Voluptate labore enim irure eu. Adipisicing et ex eu officia.",
    "registered": "Tuesday, April 22, 2014 4:43 AM",
    "latitude": "-64.474619",
    "longitude": "73.314626",
    "tags": [
      "irure",
      "adipisicing",
      "ad",
      "commodo",
      "id"
    ],
    "range": [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9
    ],
    "friends": [
      {
        "id": 0,
        "name": "Wilson Pierce"
      },
      {
        "id": 1,
        "name": "Clark Dunn"
      },
      {
        "id": 2,
        "name": "Woodward Reeves"
      }
    ],
    "greeting": "Hello, Watkins! You have 9 unread messages.",
    "favoriteFruit": "apple"
  },
  {
    "_id": "5bc3b1b7597e2a435766d8ce",
    "index": 7,
    "guid": "5c9ec1b4-23eb-49c9-a2f4-59cbac7fb410",
    "isActive": true,
    "balance": "$2,688.43",
    "picture": "http://placehold.it/32x32",
    "age": 38,
    "eyeColor": "blue",
    "name": {
      "first": "Sweet",
      "last": "Dunlap"
    },
    "company": "DELPHIDE",
    "email": "sweet.dunlap@delphide.us",
    "phone": "+1 (826) 547-2050",
    "address": "610 Highland Boulevard, Konterra, Guam, 3979",
    "about": "Minim voluptate sit ad culpa. Cupidatat culpa non irure nostrud enim pariatur velit voluptate sunt. Sunt anim aute consequat labore enim commodo veniam Lorem esse elit culpa enim fugiat elit. Adipisicing non ad commodo aute officia ad adipisicing nostrud aliquip. Ea non sit do cillum aliquip ullamco proident duis nostrud incididunt in incididunt exercitation. Nisi duis aute ut incididunt enim sit et tempor.",
    "registered": "Friday, September 18, 2015 2:25 AM",
    "latitude": "1.936853",
    "longitude": "-87.885395",
    "tags": [
      "cillum",
      "cillum",
      "consectetur",
      "veniam",
      "ea"
    ],
    "range": [
      0,
      1,
      2,
      3,
      4,
      5,
      6,
      7,
      8,
      9
    ],
    "friends": [
      {
        "id": 0,
        "name": "Frost Watts"
      },
      {
        "id": 1,
        "name": "Brewer Santiago"
      },
      {
        "id": 2,
        "name": "Jarvis Obrien"
      }
    ],
    "greeting": "Hello, Sweet! You have 6 unread messages.",
    "favoriteFruit": "apple"
  }
]"""

let sample2 = """[
  "\u0000\u0001\b\f\n\t\r\\\"",
  "𠮷野家",
  0,
  1,
  1.111,
  0e0,
  1.1111e+1111
]"""

open System
open Malmacs

[<EntryPoint>]
let main argv =
    let ensure cond = if not cond then failwith ""
    let json1 = MalJson.parse sample1
    ensure (MalJson.print false json1 = sample1)
    ensure (MalJson.parse (MalJson.print true json1) = json1)
    ensure (MalJson.print false (MalJson.parse sample2) = sample2)
    
    let error input pos =
        let errorPos =
            try
                MalJson.parse input |> ignore
                -1
            with
            | MalJson.InvalidChar i -> i
            | MalJson.UnexpectedEof -> input.Length
        if errorPos <> pos then failwithf ""
    
    error "[00]" 2
    error "[1.]" 3
    error "[1.0e]" 5
    error "[\"a" 3
    error "[\"aa" 4
    error "[\"\\u00\"]" 6
    error "[\"\\u000\"]" 7

    printfn "done."
    Console.ReadKey() |> ignore
    0
